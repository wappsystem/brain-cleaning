<div id=D__ID>
    <script>
        function F__ID(){
            //------------------------------------
            $vm.init(function(){
                $vm.init_status=1;
                if($vm.show_user!=undefined) $vm.show_user();
            })
            //------------------------------------
            /*window.onmessage=function(e){
                if(e.data.username!=undefined && e.data.token!=undefined){
                    $vm.user_name=e.data.username;
                    $vm.set_token(e.data.token,e.data.username);
                    var api_name="wapp";
                    sessionStorage.setItem(api_name+" token",e.data.token);
                    location.reload(true);
                }
            };

            */
            //--------------------------------------------------------
            var u=window.location.origin;
            //if(u=="http://localhost:8000") u=u+"/auth.html";
            u=u+"/auth.html"
            $vm.auth_signin=function(){
                url='https://login.microsoftonline.com/common/oauth2/v2.0/authorize';
                url+='?client_id=6f0a5a8b-9c65-4c0d-a131-23711720936d'; //brain from wapp
                url+='&response_type=code';
                url+='&redirect_uri='+u;
                url+='&scope=openid user.read profile'; 
                url+='&response_mode=fragment';
                url+='&state=exchange-microsoft-token.wapp_microsoft';
                url+='&nonce=678910';
                url+='&prompt=select_account';
                window.open(url);
            }
            //--------------------------------------------------------
            $vm.auth_signout=function(){
                //sessionStorage.clear();
                //window.location.href=$vm.hosting_path+"/";
            }
            //------------------------------------
            window.onmessage=function(e){
                alert(e);
                /*
                if (e.origin == window.location.origin){
                    var href=e.data.href;
                    if(href==undefined) return;
                    var code=href.split('code=').pop();
                    code=code.split('&')[0];
	                var state=href.split('state=exchange').pop();
	                state="exchange"+state.split('&')[0];
	                state=state.split('#')[0];
                    if(code!=undefined && state!=undefined){
                        var cmd=state.split('.')[0];
                        var id=state.split('.').pop();
                        $vm.request_token(id,cmd,code,u,href,function(id,res){
                            $vm.show_user();
                        });
                    }
                }
                */
            }
            //------------------------------------
      
            $vm.auth_signin();
        }
    </script>
</div>
